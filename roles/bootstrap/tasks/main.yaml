- name: Checkout the cluster project
  ansible.builtin.git:
    repo: "https://github.com/brotherlogic/cluster2.git"
    dest: /home/simon/cluster

- name: Add a cron task to bootstrap the cluster every hour
  ansible.builtin.cron:
    name: CLUSTER_BOOTSTRAP
    minute: "*/5"
    job: "/home/simon/cluster/bootstrap.sh"

- name: Install kubectl packages
  ansible.builtin.apt:
    pkg:
    - apt-transport-https
    - ca-certificates
    - gnupg

- name: Download kubectl key
   shell: curl -fsSL {{ k8s_url_apt_key }} | gpg --dearmor -o {{ k8s_gpgpath }}
      args:
        creates: "{{ k8s_gpgpath }}"

- name: Install Kubernetes repository
  apt_repository:
    filename: kubernetes
    repo: "deb [signed-by={{ k8s_gpgpath }}] {{ k8s_repository }} /"

- name: Install Kubernetes Packages
      package: name={{ item }} state=present force=yes install_recommends=no
      loop: "{{ k8s_packages }}"